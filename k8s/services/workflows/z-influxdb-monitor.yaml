apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: z-influxdb-monitor
  namespace: argo
spec:
  podGC:
    strategy: OnWorkflowCompletion
  templates:
    - name: infulxdb-monitor
      container:
        command:
          - '/influxdb-monitor'
          - '--timeout'
          - '5m'
          - '--organisation'
          - '1'
        name: influxdb-monitor
        #TODO update docker tag for image
        image: europe-west3-docker.pkg.dev/sentry-st-testing/main/influxdb-monitor:FIX_ME-1dc8ab4863bbfa0a98098bc229bf5e7637b8355f
        resources: {}
      env:
        - name: INFLUX_TOKEN
          valueFrom:
            secretKeyRef:
              name: influx-rw
              key: token
        - name: INFLUX_URL
          value: 'http://influxdb-server.default.svc.cluster.local'
